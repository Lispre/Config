#!/usr/bin/env ocaml

Random.self_init ();;

(* randomly choose a wallpaper *)
let pics = Sys.readdir "/home/ray/wallpapers";;
let pic = "feh --bg-scale /home/ray/wallpapers/" ^ (Array.get pics (Random.int (Array.length pics))) ^ " &";;

let singleton s =
  let comm =
    try String.sub s 0 (String.index s ' ')
    with Not_found -> s
  in "killall -0 -r " ^ comm ^ " || " ^ s;;

List.map Sys.command [
  (* resident *)
  singleton "tmux new -d -s weechat -n weechat weechat-curses \\; new -d -s default -t weechat\\; new-window"
  ; singleton "parcellite &"
  ; singleton "gol &"
  ; singleton "fcitx &"

  (* one-shot *)
  ; "xrandr | grep -q HDMI && { xrandr -s 1920x1080 --output HDMI-0 --mode 1920x1080 --output LVDS --right-of HDMI-0 --off; }"
  ; "LC_ALL= LC_CTYPE=zh_CN.UTF-8 emacs --daemon"
  ; "xrdb ~/.Xresources"
  ; "setxkbmap -option ctrl:nocaps -option keypad:pointerkeys"
  ; pic
  ; "redshift"
  ; "xcompmgr -c &"
  ; "urxvtd -f -q -o"
];;
